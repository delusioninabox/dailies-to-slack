var feedURL="http://delusioninabox.tumblr.com/rss",channel="dailies",category="daily",postLimit=1,webhookURL="https://hooks.slack.com/services/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",yourSlackToken="xoxb-306133494614-cxZVPzOaF6PuuwEOYaRxxPHU";
console.log("Reading variables..."),0===webhookURL.length||0===feedURL.length||0===yourSlackToken.length||0===channel.length?console.log("Please check your config.js file for missing data."):console.log("Config approved.");var request=require("request"),FeedParser=require("feedparser"),slackAPI="https://slack.com/api/";function getFeed(e,o){var t=request(e),n=new FeedParser,r=new Array;t.on("response",function(e){200==e.statusCode&&this.pipe(n)}),t.on("error",function(e){console.log("getFeed: err.message == "+e.message)}),n.on("readable",function(){try{var e=this.read();null!==e&&r.push(e)}catch(e){console.log("getFeed: err.message == "+e.message)}}),n.on("end",function(){o(void 0,r)}),n.on("error",function(e){console.log("getFeed: err.message == "+e.message),o(e)})}function postToSlack(e){var o=e.title,t=e.description,n=e.pubdate,r=e.link,s=e.image;if(s.length)s=s.url;else{s=/<img[^>]+src="?([^"\s]+)"?\s*\/>/g.exec(t)[1],console.log("No image, checked description.")}request.post(webhookURL,{json:{text:"",attachments:[{author_name:"",color:"#008080",title:o,title_link:r,image_url:s,footer:"Dailies To Slack | "+n,footer_icon:"http://78.media.tumblr.com/avatar_6f945e8452bd_128.pnj"}]}},function(e,t,n){e||console.log("Posted "+o)})}getFeed(feedURL,function(e,o){if(!e){request.get(slackAPI+"channels.list?exclude_archived=true&exclude_members=true&token="+yourSlackToken,function(e,o,t){if(!e)for(var n=JSON.parse(t).channels,r=0;r<n.length;r++)console.log(n[r].name)});var t=o.length,n=0;console.log(t+" items were found in the feed.");for(var r=0;r<o.length;r++){if(""!==category)o[r].categories.indexOf(category)>-1&&n++;else n++;postLimit>0&&n==postLimit&&(r=t,console.log("Post limit reached, breaking queue."))}}});