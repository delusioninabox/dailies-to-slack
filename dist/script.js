var feedURL="http://delusioninabox.tumblr.com/rss",category="daily",postLimit=1,webhookURL="https://hooks.slack.com/services/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";
console.log("Reading variables..."),0===webhookURL.length||0===feedURL.length?console.log("Please check your config.js file for missing data."):console.log("Config approved.");var request=require("request"),FeedParser=require("feedparser");function getFeed(e,o){var t=request(e),s=new FeedParser,n=new Array;t.on("response",function(e){200==e.statusCode&&this.pipe(s)}),t.on("error",function(e){console.log("getFeed: err.message == "+e.message)}),s.on("readable",function(){try{var e=this.read();null!==e&&n.push(e)}catch(e){console.log("getFeed: err.message == "+e.message)}}),s.on("end",function(){o(void 0,n)}),s.on("error",function(e){console.log("getFeed: err.message == "+e.message),o(e)})}function postToSlack(e){var o=e.title,t=e.description,s=e.pubdate,n=e.link,r=e.image;if(r.length)r=r.url;else{r=/<img[^>]+src="?([^"\s]+)"?\s*\/>/g.exec(t)[1],console.log("No image, checked description.")}request.post(webhookURL,{json:{text:"*New Post*",attachments:[{author_name:"",color:"#008080",title:o,title_link:n,image_url:r,footer:"Dailies To Slack | "+s,footer_icon:"http://78.media.tumblr.com/avatar_6f945e8452bd_128.pnj"}]}},function(e,t,s){e||console.log("Posted "+o)})}getFeed(feedURL,function(e,o){if(!e){var t=o.length,s=0;console.log(t+" items were found in the feed.");for(var n=0;n<o.length;n++){if(""!==category)o[n].categories.indexOf(category)>-1&&(postToSlack(o[n]),s++);else postToSlack(o[n]),s++;postLimit>0&&s==postLimit&&(n=t,console.log("Post limit reached, breaking queue."))}}});